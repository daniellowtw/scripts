# Linux setup commands

# List all available recipes (default)
default:
    @just --list

# Install Pi-hole (network-wide ad blocker)
install-pihole:
    @echo "Installing Pi-hole..."
    @echo "This will make significant system changes (DNS server, web server, etc.)"
    curl -sSL https://install.pi-hole.net | bash

install-uv:
    curl -LsSf https://astral.sh/uv/install.sh | sh

install-node:
    #!/usr/bin/env bash
    #https://nodejs.org/en/download
    curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.40.3/install.sh | bash
    # in lieu of restarting the shell
    \. "$HOME/.nvm/nvm.sh"
    nvm install 24
    node -v # Should print "v24.13.1".
    corepack enable pnpm
    pnpm -v

# Install Tailscale (mesh VPN)
install-tailscale:
    @echo "Installing Tailscale..."
    @echo "Adding Tailscale repository and signing key..."
    curl -fsSL https://pkgs.tailscale.com/stable/debian/trixie.noarmor.gpg | sudo tee /usr/share/keyrings/tailscale-archive-keyring.gpg >/dev/null
    curl -fsSL https://pkgs.tailscale.com/stable/debian/trixie.tailscale-keyring.list | sudo tee /etc/apt/sources.list.d/tailscale.list
    @echo "Updating package list and installing Tailscale..."
    sudo apt-get update
    sudo apt-get install -y tailscale
    @echo "Tailscale installed successfully!"
    @echo "Run 'sudo tailscale up' to connect to your network"
    @echo "Run 'tailscale ip -4' to see your Tailscale IP address"

install-forgejo-runner:
    #!/usr/bin/env bash
    export ARCH=$(uname -m | sed 's/x86_64/amd64/;s/aarch64/arm64/')
    export RUNNER_VERSION=$(curl -X 'GET' https://data.forgejo.org/api/v1/repos/forgejo/runner/releases/latest | jq .name -r | cut -c 2-)
    export FORGEJO_URL="https://code.forgejo.org/forgejo/runner/releases/download/v${RUNNER_VERSION}/forgejo-runner-${RUNNER_VERSION}-linux-${ARCH}"
    wget -O forgejo-runner ${FORGEJO_URL} || curl -o forgejo-runner ${FORGEJO_URL}
    chmod +x forgejo-runner
    wget -O forgejo-runner.asc ${FORGEJO_URL}.asc || curl -o forgejo-runner.asc ${FORGEJO_URL}.asc
    gpg --keyserver hkps://keys.openpgp.org --recv EB114F5E6C0DC2BCDD183550A4B61A2DC5923710
    gpg --verify forgejo-runner.asc forgejo-runner && echo "✓ Verified" || echo "✗ Failed"

